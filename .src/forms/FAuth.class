' Gambas class file

Private Sub PassOk()

    MMain.strCurrentUser = cmbUsername.Text
    Me.Close()
    FMain.Show()

End

Private Sub PassError()

    Message.Error(("Password you entered is incorrect"))
    txbPassword.Clear()
    txbPassword.SetFocus()

End

Public Sub Form_Open()

    Dim bytDefault As Byte

    Me.Center()
    Message.Title = "Accel GUI"
    bytDefault = CByte(MMain.objSettings["Auth/default", "0"])
    cmbUsername.Index = bytDefault

End

Public Sub btnExit_Click()

    Me.Close()

End

Public Sub btnEnter_Click()

    Dim strSavedPass As String
    Dim strEnteredPass As String

    strSavedPass = MMain.objSettings["Auth/" & cmbUsername.Text, ""]
    strEnteredPass = Crypt.SHA512(txbPassword.Text, MMain.PREFIX)
    If strSavedPass <> "" Then
        If strEnteredPass = strSavedPass Then
            PassOk()
        Else
            PassError()
        Endif
    Else
        If txbPassword.Text = cmbUsername.Text Then
            PassOk()
        Else
            PassError()
        Endif
    Endif

End

Public Sub cmbUsername_Click()

    txbPassword.SetFocus()

End
